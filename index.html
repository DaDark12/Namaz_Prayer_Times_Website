<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Namaz Prayer Times</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>Namaz Prayer Times & Qibla Finder</h1>
    </header>

    <main>
        <!-- Prayer Times Section -->
        <section class="prayer-times">
            <h2>Prayer Times</h2>
            <ul id="prayer-list">
                <li>Fajr: —</li>
                <li>Dhuhr: —</li>
                <li>Asr: —</li>
                <li>Maghrib: —</li>
                <li>Isha: —</li>
            </ul>
        </section>

        <!-- Qibla Finder Section -->
        <section class="qibla-section">
            <h2>Qibla Finder</h2>
            <div class="qibla-container">
                <div id="qibla-compass">
                    <div id="qibla-needle"></div>
                </div>
                <div id="qibla-angle">—°</div>
                <button id="view-switch">Switch View</button>
            </div>
        </section>
    </main>

    <footer>
        <p>© 2025 Namaz Prayer Times</p>
    </footer>

    <!-- Qibla Script -->
    <script>
    // ----- Qibla Calculation -----
    function toRadians(deg) { return deg * Math.PI / 180; }
    function toDegrees(rad) { return rad * 180 / Math.PI; }

    function calculateQibla(lat, lon) {
        const kaabaLat = 21.4225;
        const kaabaLon = 39.8262;

        const phiK = toRadians(kaabaLat);
        const phiL = toRadians(lat);
        const deltaLambda = toRadians(kaabaLon - lon);

        const x = Math.sin(deltaLambda);
        const y = Math.cos(phiL) * Math.tan(phiK) - Math.sin(phiL) * Math.cos(deltaLambda);
        let qibla = toDegrees(Math.atan2(x, y));
        if(qibla < 0) qibla += 360;
        return qibla;
    }

    function updateQibla() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition((pos) => {
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;
                const qibla = calculateQibla(lat, lon);

                document.getElementById("qibla-angle").innerText = Math.round(qibla) + "°";
                document.getElementById("qibla-needle").style.transform = `rotate(${qibla}deg)`;
            }, () => {
                alert("Unable to get your location. Please allow location access.");
            });
        } else {
            alert("Geolocation not supported in your browser.");
        }
    }

    // ----- View Switcher -----
    const body = document.body;
    const switchBtn = document.getElementById("view-switch");

    function detectView() {
        if(window.innerWidth <= 768) body.classList.add("mobile-view");
        else body.classList.remove("mobile-view");
    }

    // Button toggle
    switchBtn.addEventListener("click", () => {
        body.classList.toggle("mobile-view");
    });

    // Detect on resize & load
    window.addEventListener("resize", detectView);
    window.addEventListener("load", () => {
        detectView();
        updateQibla();
    });
    </script>
</body>
</html>
